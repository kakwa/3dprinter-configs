Starting Klippy...
Args: ['/home/fly/klipper/klippy/klippy.py', '/home/fly/klipper_config/printer.cfg', '-l', '/home/fly/klipper_logs/klippy.log', '-a', '/tmp/klippy_uds']
Git version: '0181023-dirty'
Modified files: klippy/extras/display/display.cfg, klippy/extras/display/menu.cfg
Branch: (HEAD detached at 0181023)
Remote: ?
Tracked URL: ?
CPU: 4 core ?
Python: '3.13.5 (main, Jun 25 2025, 18:55:22) [GCC 14.2.0]'
Start printer at Sat Aug 16 13:43:33 2025 (1755351813.1 29.5)
===== Config file =====
[gcode_macro SHUTDOWN]
gcode = 
	{action_call_remote_method("shutdown_machine")}

[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set x = params.X|default(230) %}
	{% set y = params.Y|default(230) %}
	{% set z = params.Z|default(10)|float %}
	{% set e = params.E|default(1) %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set lift_z = z|abs %}
	{% if act_z < (max_z - lift_z) %}
	{% set z_safe = lift_z %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{e} F2100
	G1 Z{z_safe}
	G90
	G1 X{x} Y{y} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	
	{% set e = params.E|default(1) %}
	G91
	G1 E{e} F2100
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1
	BASE_RESUME

[homing_override]
axes = xyz
set_position_z = 0
gcode = 
	G90
	G0 Z5 F600
	{% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}
	
	{% if home_all or 'X' in params %}
	_HOME_X
	{% endif %}
	
	{% if home_all or 'Y' in params %}
	_HOME_Y
	{% endif %}
	
	{% if home_all or 'Z' in params %}
	_HOME_Z
	{% endif %}

[bed_screws]
screw1 = 60,5
screw1_name = front screw
screw2 = 5,115
screw2_name = back left
screw3 = 115,115
screw3_name = back right
probe_height = 0.1

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 E10 F300
	G1 E-40 F1800
	M82

[gcode_macro _HOME_X]
gcode = 
	
	{% set RUN_CURRENT_X = printer.configfile.settings['tmc2209 stepper_x'].run_current|float %}
	{% set RUN_CURRENT_Y = printer.configfile.settings['tmc2209 stepper_y'].run_current|float %}
	{% set HOME_CURRENT = 0.75 %}
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CURRENT}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CURRENT}
	
	
	G28 X
	
	G91
	G1 X-10 F1200
	
	
	G4 P1000
	G90
	
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CURRENT_X}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CURRENT_Y}

[gcode_macro _HOME_Y]
gcode = 
	
	{% set RUN_CURRENT_X = printer.configfile.settings['tmc2209 stepper_x'].run_current|float %}
	{% set RUN_CURRENT_Y = printer.configfile.settings['tmc2209 stepper_y'].run_current|float %}
	{% set HOME_CURRENT = 0.75 %}
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CURRENT}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CURRENT}
	
	
	G28 Y
	
	G91
	G1 Y-10 F1200
	
	
	G4 P1000
	G90
	
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CURRENT_X}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CURRENT_Y}

[gcode_macro _HOME_Z]
gcode = 
	G90
	G28 Z
	G1 Z30

[board_pins]
aliases = 
	
	X_EN=PA3, X_STEP=PC13, X_DIR=PC1, X_CS=PB11,
	Y_EN=PD2, Y_STEP=PC14,  Y_DIR=PC4,  Y_CS=PC10,
	Z_EN=PC12,  Z_STEP=PC15, Z_DIR=PC5,  Z_CS=PB7,
	E_EN=PC11,  E_STEP=PC3,  E_DIR=PC8,  E_CS=PB6,
	
	
	BED_OUT=PA2,
	HEAT=PA0,
	
	
	BED_TEMP=PC2,
	HEAT_TEMP=PC0,
	
	
	FAN0=PC6, FAN1=PC7,
	
	
	X_STOP=PA4,  Y_STOP=PA5,  Z_STOP=PA6,
	
	
	EXP1_1=PC9,  EXP1_3=PA13,  EXP1_5=PA9,   EXP1_7=<NC>,  EXP1_9=<GND>,
	EXP1_2=PB6,  EXP1_4=PA10,  EXP1_6=PA8,   EXP1_8=<NC>,  EXP1_10=<5V>,
	
	EXP2_1=PB14, EXP2_3=PA15,  EXP2_5=PA14,  EXP2_7=PC10,   EXP2_9=<GND>,
	EXP2_2=PB13, EXP2_4=PB12,  EXP2_6=PB15,  EXP2_8=<RST>, EXP2_10=<NC>,
	
	
	
	SERVO=PB0,
	PROBE=PA1

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32f405xx_JKYZ-if00

[mcu host]
serial = /tmp/klipper_host_mcu

[virtual_sdcard]
path = /home/fly/printer_data/gcodes

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_z_velocity = 5
max_z_accel = 100

[temperature_sensor FLY-Gemini]
sensor_type = temperature_host

[temperature_fan mcu_fan]
pin = FAN1
kick_start_time = 0.500
sensor_type = temperature_mcu
control = watermark
target_temp = 45.0
min_temp = 0
max_temp = 90
max_speed = 1.0
min_speed = 0.8

[output_pin HE-LED]
pin = host:gpio3
pwm = False

[filament_switch_sensor DLJC]
pause_on_runout = True
runout_gcode = PAUSE
insert_gcode = RESUME
event_delay = 3.0
pause_delay = 0.5
switch_pin = !PB1

[stepper_x]
step_pin = X_STEP
dir_pin = X_DIR
enable_pin = !X_EN
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 120
position_max = 120
homing_speed = 30
homing_retract_dist = 0
homing_positive_dir = true
step_pulse_duration = 0.000001

[stepper_y]
step_pin = Y_STEP
dir_pin = Y_DIR
enable_pin = !Y_EN
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 120
position_max = 120
homing_speed = 30
homing_retract_dist = 0
homing_positive_dir = true
step_pulse_duration = 0.000001

[stepper_z]
step_pin = Z_STEP
dir_pin = !Z_DIR
enable_pin = !Z_EN
rotation_distance = 8
microsteps = 32
endstop_pin = Z_STOP
position_max = 120
position_min = -1.5
homing_speed = 120
second_homing_speed = 3.0
homing_retract_dist = 3.0
position_endstop = 117.870

[extruder]
step_pin = E_STEP
dir_pin = !E_DIR
enable_pin = !E_EN
microsteps = 16
rotation_distance = 23
gear_ratio = 50:10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = HEAT
sensor_pin = HEAT_TEMP
sensor_type = ATC Semitec 104GT-2
control = pid
pid_kp = 22.2
pid_ki = 1.08
pid_kd = 114
min_temp = -100
max_temp = 350
min_extrude_temp = 10
step_pulse_duration = 0.000004

[heater_bed]
heater_pin = BED_OUT
sensor_pin = BED_TEMP
sensor_type = ATC Semitec 104GT-2
control = watermark
min_temp = -100
max_temp = 110
max_power = 1.0

[neopixel bed_neopixel]
pin = PA9
chain_count = 8
color_order = GRB
initial_red = 0.2
initial_green = 0.2
initial_blue = 0.2

[fan]
pin = FAN0

[tmc2209 stepper_x]
uart_pin = X_CS
interpolate = False
run_current = 1.0
sense_resistor = 0.110
stealthchop_threshold = 200
diag_pin = PA4
driver_sgthrs = 70

[tmc2209 stepper_y]
uart_pin = Y_CS
interpolate = False
run_current = 1.0
sense_resistor = 0.110
stealthchop_threshold = 200
diag_pin = PA5
driver_sgthrs = 70

[tmc2209 stepper_z]
uart_pin = Z_CS
run_current = 0.6500
interpolate = False

[tmc2209 extruder]
uart_pin = E_CS
run_current = 0.6500
interpolate = False

[gcode_macro PRINT_START]
description = 开始打印
gcode = 
	G90
	M107
	M82
	G28
	G1 Z20 F3000
	G92 E0
	G1 X110 Y0.5 F2000
	G1 Z0.28 F400
	G1 X30 Y0.5 E18 F1000
	G1 Z0.5 F200
	G92 E0

[gcode_macro PRINT_END]
gcode = 
	M400
	G92 E0
	G1 E-4.0 F3600
	G91
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y20 F3600
	SET_SKEW CLEAR=1
	M18

[gcode_macro STOP_LED]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro Rainbow_LED]
gcode = 
	SET_LED_EFFECT EFFECT=panel_idle
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Klipper_stm32f405xx_JKYZ-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Klipper_stm32f405xx_JKYZ-if00'
